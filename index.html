<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Controle de D√≠vidas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f5f5;
      color: #333;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 24px 30px;
    }
    .header h1 {
      margin: 0 0 8px;
      font-size: 28px;
      font-weight: 600;
    }
    .header p {
      margin: 0;
      opacity: 0.95;
      font-size: 14px;
    }
    .content {
      padding: 20px 30px;
    }
    .toolbar {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-primary {
      background: #667eea;
      color: white;
    }
    .btn-primary:hover {
      background: #5568d3;
    }
    .btn-secondary {
      background: #e0e7ff;
      color: #667eea;
    }
    .btn-secondary:hover {
      background: #c7d2fe;
    }
    .btn-danger {
      background: #fee;
      color: #dc2626;
    }
    .btn-danger:hover {
      background: #fdd;
    }
    .btn-success {
      background: #10b981;
      color: white;
    }
    .btn-success:hover {
      background: #059669;
    }
    .table-section {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border: 1px solid #e5e7eb;
    }
    thead {
      background: #f9fafb;
      border-bottom: 2px solid #e5e7eb;
    }
    th {
      padding: 6px 8px;
      text-align: left;
      font-weight: 600;
      font-size: 13px;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    th.num { text-align: right; }
    td {
      padding: 4px 8px;
      border-bottom: 1px solid #f3f4f6;
    }
    tbody tr:hover {
      background: #fafafa;
    }
    tfoot {
      background: #f9fafb;
      border-top: 2px solid #e5e7eb;
      font-weight: 700;
    }
    tfoot td {
      padding: 8px 8px;
      font-size: 15px;
    }
    input, select {
      width: 100%;
      padding: 4px 6px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      font-size: 14px;
      font-family: inherit;
    }
    input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .num { text-align: right; }
    .vencido {
      background-color: #fee2e2 !important;
    }
    .em-dia {
      background-color: #d1fae5 !important;
    }
    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    .badge-vencido {
      background: #dc2626;
      color: white;
    }
    .badge-em-dia {
      background: #059669;
      color: white;
    }
    .btn-remove {
      padding: 4px 10px;
      font-size: 12px;
      background: #fee;
      color: #dc2626;
      border: 1px solid #fdd;
    }
    .btn-remove:hover {
      background: #fdd;
    }
    .Estilo1 {
      text-align: right;
      color: #0000FF;
      font-size: 12px;
      font-weight: bold;
    }
    .Estilo2 {font-size: 13px}
    @media print {
      .toolbar { display: none; }
      body { background: white; }
      .container { box-shadow: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üí∞ Controle de D√≠vidas</h1>
      <p>Anote suas d√≠vidas e mantenha tudo organizado em um s√≥ lugar</p>
    </div>

    <div class="content">
      <div class="toolbar">
        <button class="btn-primary" onClick="addRow()">‚ûï Adicionar D√≠vida</button>
        <button class="btn-secondary" onClick="document.getElementById('csvInput').click()">üì§Abrir salvo </button>
        <button class="btn-secondary" onClick="exportCSV()">üíæ Salvar</button>
        <button class="btn-danger" onClick="resetData()">üîÑ Resetar Dados</button>
        <button class="btn-success" onClick="savePDF()">üìÑ Salvar em PDF</button>
        <input type="file" id="csvInput" accept=".csv" style="display: none;" onChange="importCSV(event)">
      </div>

      <div class="table-section">
        <table>
          <thead>
            <tr>
              <th style="width: 50px;">Status</th>
              <th>Credor</th>
              <th class="num">Valor Original</th>
              <th bordercolor="#000000" bgcolor="#FFFF00" class="Estilo1"><div align="center"><span class="Estilo2">Juros</span> (% m√™s)</div></th>
              <th class="num">Total Atual</th>
              <th>Vencimento</th>
              <th class="num">Valor M√≠nimo</th>
              <th style="width: 80px;"></th>
            </tr>
          </thead>
          <tbody id="tbody">
          </tbody>
          <tfoot>
            <tr>
              <td></td>
              <td><strong>TOTAL</strong></td>
              <td class="num" id="sumOriginal">R$ 0,00</td>
              <td class="num" id="avgJuros">M√©dia: 0,00%</td>
              <td class="num" id="sumTotal">R$ 0,00</td>
              <td></td>
              <td class="num" id="sumMin">R$ 0,00</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <script>
    const brCurrency = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
    const brPercent = new Intl.NumberFormat('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

    function parseNumberBR(str) {
      if (!str) return NaN;
      const s = String(str).trim().replace(/[R$\s]/g, '').replace(/\./g, '').replace(',', '.');
      const n = Number(s);
      return Number.isFinite(n) ? n : NaN;
    }

    function formatCurrency(n) { return brCurrency.format(Number(n || 0)); }
    function formatPercent(n) { return `${brPercent.format(Number(n || 0))}%`; }

    const initialData = [
      { credor: 'Cart√£o A', original: 3500, juros: 14.9, total: 4218, venc: '2026-04-10', minimo: 420 },
      { credor: 'Empr√©stimo B', original: 8000, juros: 4.5, total: 8360, venc: '2026-04-15', minimo: 480 },
    ];

    const tbody = document.getElementById('tbody');

    function getStatusClass(dateStr) {
      if (!dateStr) return '';
      const vencDate = new Date(dateStr + 'T00:00:00');
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      return vencDate < today ? 'vencido' : 'em-dia';
    }

    function getStatusBadge(dateStr) {
      if (!dateStr) return '';
      const vencDate = new Date(dateStr + 'T00:00:00');
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      if (vencDate < today) {
        return '<span class="status-badge badge-vencido">‚ö†Ô∏è VENCIDO</span>';
      } else {
        return '<span class="status-badge badge-em-dia">‚úì EM DIA</span>';
      }
    }

    function createRow(data = {}) {
      const tr = document.createElement('tr');
      const statusClass = getStatusClass(data.venc);
      if (statusClass) tr.classList.add(statusClass);

      tr.innerHTML = `
        <td class="status-cell"></td>
        <td><input type="text" placeholder="Ex: Cart√£o Visa" value="${data.credor || ''}"></td>
        <td class="num"><input type="text" placeholder="0,00" value="${data.original || ''}"></td>
        <td class="num"><input type="text" placeholder="0,00" value="${data.juros || ''}"></td>
        <td class="num"><input type="text" placeholder="0,00" value="${data.total || ''}"></td>
        <td><input type="date" value="${data.venc || ''}"></td>
        <td class="num"><input type="text" placeholder="0,00" value="${data.minimo || ''}"></td>
        <td><button class="btn-remove" onclick="removeRow(this)">Remover</button></td>
      `;

      const dateInput = tr.querySelector('input[type="date"]');
      dateInput.addEventListener('change', function() {
        tr.className = '';
        const statusClass = getStatusClass(this.value);
        if (statusClass) tr.classList.add(statusClass);
        updateStatusBadge(tr, this.value);
        recalc();
      });

      tr.querySelectorAll('input').forEach(inp => {
        inp.addEventListener('input', recalc);
      });

      updateStatusBadge(tr, data.venc);
      tbody.appendChild(tr);
    }

    function updateStatusBadge(tr, dateStr) {
      const statusCell = tr.querySelector('.status-cell');
      statusCell.innerHTML = getStatusBadge(dateStr);
    }

    function addRow() {
      createRow();
      recalc();
    }

    function removeRow(btn) {
      btn.closest('tr').remove();
      recalc();
    }

    function recalc() {
      let sumOriginal = 0;
      let sumTotal = 0;
      let sumMin = 0;
      let jurosVals = [];

      for (const tr of tbody.querySelectorAll('tr')) {
        const inputs = tr.querySelectorAll('input');
        const original = parseNumberBR(inputs[1].value);
        const juros = parseNumberBR(inputs[2].value);
        const total = parseNumberBR(inputs[3].value);
        const minimo = parseNumberBR(inputs[5].value);

        if (Number.isFinite(original)) sumOriginal += original;
        if (Number.isFinite(total)) sumTotal += total;
        if (Number.isFinite(minimo)) sumMin += minimo;
        if (Number.isFinite(juros)) jurosVals.push(juros);
      }

      const avgJuros = jurosVals.length ? jurosVals.reduce((a, b) => a + b, 0) / jurosVals.length : 0;

      document.getElementById('sumOriginal').textContent = formatCurrency(sumOriginal);
      document.getElementById('sumTotal').textContent = formatCurrency(sumTotal);
      document.getElementById('sumMin').textContent = formatCurrency(sumMin);
      document.getElementById('avgJuros').textContent = `M√©dia: ${formatPercent(avgJuros)}`;
    }

    function importCSV(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        const text = e.target.result;
        const lines = text.split('\n').filter(line => line.trim());
        
        if (lines.length < 2) {
          alert('Arquivo CSV vazio ou inv√°lido!');
          return;
        }

        if (confirm('Deseja substituir os dados atuais pelos dados do CSV?')) {
          tbody.innerHTML = '';
          
          for (let i = 1; i < lines.length; i++) {
            const line = lines[i];
            const fields = [];
            let current = '';
            let inQuotes = false;
            
            for (let char of line) {
              if (char === '"') {
                inQuotes = !inQuotes;
              } else if (char === ',' && !inQuotes) {
                fields.push(current.trim());
                current = '';
              } else {
                current += char;
              }
            }
            fields.push(current.trim());

            if (fields.length >= 6) {
              const data = {
                credor: fields[0],
                original: fields[1],
                juros: fields[2],
                total: fields[3],
                venc: fields[4],
                minimo: fields[5]
              };
              createRow(data);
            }
          }
          recalc();
          alert('CSV importado com sucesso!');
        }
      };
      reader.readAsText(file, 'UTF-8');
      event.target.value = '';
    }

    function exportCSV() {
      const headers = ['Credor', 'Valor Original', 'Juros (% m√™s)', 'Total Atual', 'Data Vencimento', 'Valor M√≠nimo'];
      const rows = [headers];

      for (const tr of tbody.querySelectorAll('tr')) {
        const inputs = tr.querySelectorAll('input');
        const row = [
          inputs[0].value.trim(),
          inputs[1].value.trim(),
          inputs[2].value.trim(),
          inputs[3].value.trim(),
          inputs[4].value.trim(),
          inputs[5].value.trim()
        ];
        
        if (row.some(cell => cell)) rows.push(row);
      }

      const csv = rows.map(r => r.map(f => {
        const field = String(f || '');
        return /[",\n]/.test(field) ? `"${field.replace(/"/g, '""')}"` : field;
      }).join(',')).join('\n');

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'dividas_' + new Date().toISOString().split('T')[0] + '.csv';
      a.click();
      URL.revokeObjectURL(a.href);
    }

    function savePDF() {
      window.print();
    }

    function resetData() {
      if (confirm('Tem certeza que deseja resetar todos os dados? Esta a√ß√£o n√£o pode ser desfeita.')) {
        tbody.innerHTML = '';
        initialData.forEach(d => createRow(d));
        recalc();
      }
    }

    function loadInitial() {
      tbody.innerHTML = '';
      initialData.forEach(d => createRow(d));
      recalc();
    }

    loadInitial();
  </script>
</body>
</html>